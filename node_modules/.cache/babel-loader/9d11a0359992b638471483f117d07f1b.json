{"ast":null,"code":"import _defineProperty from \"/home/danil/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/React/my-app-local/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport API from '../API/api.js';\nimport { stopSubmit } from 'redux-form';\nimport { auth_setUser, auth_delAuthInfo, auth_setAuthUser } from './dispatch-types.js';\nlet data = {\n  id: null,\n  name: null,\n  isAuth: false,\n  follows: null,\n  img: null,\n  errors: {\n    name: null,\n    mail: null,\n    password: null\n  }\n};\nexport const AuthReducer = (state = data, action) => {\n  switch (action.type) {\n    case 'SET-AUTH-USER':\n      {\n        return _objectSpread({}, state, {\n          name: action.data.name,\n          id: action.data.id,\n          follows: action.data.follows,\n          img: action.data.img,\n          isAuth: true\n        });\n      }\n\n    case \"SET-FOLLOWS\":\n      {\n        return _objectSpread({}, state, {\n          follows: action.data\n        });\n      }\n\n    case \"SET-AUTH-ERRORS\":\n      {\n        return _objectSpread({}, state, {\n          errors: action.data\n        });\n      }\n\n    case \"DELETE-AUTH-INFO\":\n      {\n        return {\n          id: null,\n          name: null,\n          isAuth: false,\n          follows: null,\n          errors: {\n            name: null,\n            mail: null,\n            password: null\n          }\n        };\n      }\n  }\n\n  return state;\n};\n\nlet cookieCreator = obj => {\n  for (let key in obj) {\n    document.cookie = key + '=' + obj[key] + \";\";\n  }\n};\n\nexport const formCheck = data => async dispatch => {\n  let res = await new API().auth(data);\n\n  if (res.data.status == 'ok') {\n    dispatch(auth_setUser(data, res));\n    cookieCreator({\n      name: data.name,\n      id: res.data.id,\n      follows: res.data.follows,\n      img: res.data.img\n    });\n    window.location.reload();\n  } else if (res.data.status == 'error') {\n    let obj = {};\n\n    if (res.data.messages.name) {\n      obj.name = 'Such user does not exist';\n    }\n\n    if (res.data.messages.mail || res.data.messages.password) {\n      obj._error = \"Mail or Password is wrong\";\n    }\n\n    dispatch(stopSubmit('login', obj));\n  }\n};\nexport const logout = () => {\n  return dispatch => {\n    dispatch(auth_delAuthInfo());\n    deleteAllCookies();\n  };\n};\nexport const isCookie = () => {\n  return dispatch => {\n    let data;\n\n    if (data = getCookie(['id', 'name', 'follows', 'img'])) {\n      dispatch(auth_setAuthUser(data));\n      return true;\n    } else {\n      return false;\n    }\n  };\n};\n\nlet getCookie = (arr, obj = {}) => {\n  for (let i = 0; i < arr.length; i++) {\n    let value = \"; \" + document.cookie;\n    let parts = value.split(\"; \" + arr[i] + \"=\");\n\n    if (parts.length > 1) {\n      obj[arr[i]] = parts.pop().split(\";\").shift();\n    } else {\n      return false;\n    }\n  }\n\n  return obj;\n};\n\nlet deleteAllCookies = () => {\n  var cookies = document.cookie.split(\";\");\n\n  for (var i = 0; i < cookies.length; i++) {\n    var cookie = cookies[i];\n    var eqPos = cookie.indexOf(\"=\");\n    var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;\n    document.cookie = name + \"=;expires=Thu, 01 Jan 1970 00:00:00 GMT\";\n  }\n};","map":{"version":3,"sources":["/home/danil/Рабочий стол/React/my-app-local/src/redux/auth-reducer.js"],"names":["API","stopSubmit","auth_setUser","auth_delAuthInfo","auth_setAuthUser","data","id","name","isAuth","follows","img","errors","mail","password","AuthReducer","state","action","type","cookieCreator","obj","key","document","cookie","formCheck","dispatch","res","auth","status","window","location","reload","messages","_error","logout","deleteAllCookies","isCookie","getCookie","arr","i","length","value","parts","split","pop","shift","cookies","eqPos","indexOf","substr"],"mappings":"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","sourcesContent":["import API from '../API/api.js'; \nimport {stopSubmit} from 'redux-form';\nimport {auth_setUser, auth_delAuthInfo, auth_setAuthUser} from './dispatch-types.js';\n\nlet data = {\n\t\tid: null,\n\t\tname: null,\n\t\tisAuth: false,\n\t\tfollows: null,\n\t\timg: null,\n\t\terrors: {\n\t\t\tname: null,\n\t\t\tmail: null,\n\t\t\tpassword: null\n\t\t}}\n\nexport const AuthReducer = (state = data, action) => {\n\n\tswitch(action.type){\n\t\tcase 'SET-AUTH-USER': {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tname: action.data.name,\n\t\t\t\tid: action.data.id,\n\t\t\t\tfollows: action.data.follows,\n\t\t\t\timg: action.data.img,\n\t\t\t\tisAuth: true\n\t\t\t}\n\t\t}\n\t\tcase \"SET-FOLLOWS\": {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfollows: action.data\n\t\t\t}\n\t\t}\n\t\tcase \"SET-AUTH-ERRORS\": {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\terrors: action.data\n\t\t\t}\n\t\t}\n\t\tcase \"DELETE-AUTH-INFO\": {\n\t\t\treturn {\n\t\t\t\tid: null,\n\t\t\t\tname: null,\n\t\t\t\tisAuth: false,\n\t\t\t\tfollows: null,\n\t\t\t\terrors: {\n\t\t\t\t\tname: null,\n\t\t\t\t\tmail: null,\n\t\t\t\t\tpassword: null\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn state;\n}\n\nlet cookieCreator = (obj) => {\n\tfor(let key in obj){\n\t\tdocument.cookie = key + '=' + obj[key] + \";\";\n\t}\n}\n\nexport const formCheck = (data) => async (dispatch) => {\n\tlet res = await new API().auth(data);\n\tif (res.data.status == 'ok') {\n\t\tdispatch(auth_setUser(data, res));\n\t\tcookieCreator({\n\t\t\tname: data.name,\n\t\t\tid: res.data.id,\n\t\t\tfollows: res.data.follows,\n\t\t\timg: res.data.img\n\t\t});\n\t\twindow.location.reload();\n\t}\n\telse if(res.data.status == 'error'){\n\t\tlet obj = {}\n\t\tif(res.data.messages.name){\n\t\t\tobj.name = 'Such user does not exist';\n\t\t}\n\t\tif(res.data.messages.mail || res.data.messages.password){\n\t\t\tobj._error = \"Mail or Password is wrong\";\n\t\t}\n\t\tdispatch(stopSubmit('login', obj));\n\t}\n}\n\nexport const logout = () => {\n\treturn (dispatch) => {\n\t\tdispatch(auth_delAuthInfo());\n\t\tdeleteAllCookies();\n\t}\n}\nexport const isCookie = () => {\n\treturn (dispatch) => {\n\t\tlet data;\n\t\tif (data = getCookie(['id', 'name', 'follows', 'img'])) {\n\t\t\tdispatch(auth_setAuthUser(data));\t\n\t\t\treturn true;\t\n\t\t}else{\n\t\t\treturn false;\n\t\t}\n\t}\t\n}\n\nlet getCookie = (arr, obj = {}) => {\n\tfor(let i = 0; i < arr.length; i++){\n\t\tlet value = \"; \" + document.cookie;\n  \t\tlet parts = value.split(\"; \" + arr[i] + \"=\");\n  \t\tif(parts.length > 1){\n  \t\t\tobj[arr[i]] = parts.pop().split(\";\").shift()\n  \t\t}else{\n  \t\t\treturn false;\t\n  \t\t}\n\t}\n\treturn obj;\n}\n\nlet deleteAllCookies = () => {\n    var cookies = document.cookie.split(\";\");\n\n    for (var i = 0; i < cookies.length; i++) {\n        var cookie = cookies[i];\n        var eqPos = cookie.indexOf(\"=\");\n        var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;\n        document.cookie = name + \"=;expires=Thu, 01 Jan 1970 00:00:00 GMT\";\n    }\n}"]},"metadata":{},"sourceType":"module"}